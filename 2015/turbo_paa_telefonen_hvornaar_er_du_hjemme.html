<!DOCTYPE html>
<html lang="da">
<head>
 <meta charset="utf-8">
 <title>Turbo p&aring telefonen - "hvorn&aringr er du hjemme?"
 | logiskhave</title>
 <meta name="description" content="Log ajourf&oslash;rt af Kresten Jacobsen.">
 <meta name="viewport" content="width=720">
 <link rel="icon" href="/static/favicon.ico">
 <link rel="apple-touch-icon" href="/static/apple-touch-icon.jpg"/>
 <link rel="stylesheet" href="/css/theme.css" type="text/css">
 <link rel="alternate" type="application/rss+xml" title="" href="/rss.xml">
</head>
<body>
    <div id="container">
        <div id="header">
            <h1><span>Jeg er</span> <a title="Kolofon" href="/colophon.html">Kresten Jacobsen.</a> <span>Dette er</span> <a title="Log" href="/"> min log.</a></h1>
        </div><!-- /header --><div class="post">
		<p class="date">11. Marts, 2015</p>
    	<h2>
            
                Turbo p&aring telefonen - "hvorn&aringr er du hjemme?"

            
        </h2>
       	<p><img alt="iPhone" src="https://log.logiskhave.dk/static/20150311_iphone5s.jpg" title="iPhone" /></p>
<p>Hver dag på vej hjem i toget spørger min bedre halvdel mig om hvornår jeg mon er hjemme. Og hver dag skal jeg kigge på oversigten, tælle stationerne, regne en ca. tid ud og skrive en SMS. Men ikke mere. For nu har jeg lavet et lille pythonscript, som ved hjælp af Pythonistas <code>location</code> metode finder mine aktuelle GPS-koordinater og sammenholder dem med S-togsstationernes ditto, finder den nærmeste station og ud fra det danner en sms med nærmeste station og forventet rejsetid (antallet af stationer * 2 minutter + 10 minutters cykeltid). Meget simpel idé, men det gav mig da lidt hovedbrud undervejs.<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup></p>
<p>Resultatet er en proces, hvor jeg 1) vælger en handling fra appen <a href="http://contrast.co/launch-center-pro/">Launch Center Pro</a>, som 2) trigger et pythonscript i <a href="http://omz-software.com/pythonista/index.html">Pythonista</a> og 3) returnerer til Launch Center Pro, med en færdig SMS.</p>
<p><img alt="Arbejdsgang" src="https://log.logiskhave.dk/static/20150311_workflow.jpg" title="Handling, script, SMS" /></p>
<p>Triggeren i Launch Center Pro ser således ud:</p>
<pre class="codehilite"><code>pythonista://home_in.py?action=run</code></pre>


<p>Python koden (som nok er meget lidt elegant) kan ses her:</p>
<pre class="codehilite"><code class="language-python">#!/usr/bin/env python
# -*- coding: utf-8 -*-

import location, time, webbrowser
import math

# Getting my coordinates and storing them in the variable 'me'
location.start_updates()
time.sleep(2)
loc = location.get_location()
location.stop_updates()
me = [loc['latitude'], loc['longitude']]

# Stations [longitude, latitude, url encoded stationname]
skovlunde = [55.723190, 12.400950, 'Skovlunde%20st.']
herlev = [55.718919, 12.443674, 'Herlev%20st.']
husum = [55.7117845, 12.4530939, 'Husum%20st.']
islev = [55.6978563, 12.4683289, 'Islev%20st.']
jyllingevej = [55.6879452, 12.4735431, 'Jyllingevej%20st.']
vanlose = [55.6879452, 12.4735431, 'Vanl%C3%B8se%20st.']
flintholm = [55.685284, 12.4871472, 'Flintholm%20st.']
peter_bangs_vej = [55.6775657, 12.4975328, 'Peter%20Bangs%20Vej%20st.']
langgade = [55.6588926, 12.5074033, 'Langgade%20st.']
valby = [55.660563, 12.5163726, 'Valby%20st.']
enghave = [55.660563, 12.5163726, 'Enghave%20st.']
dybbolsbro = [55.6602483, 12.5567988, 'Dybb%C3%B8lsbro%20st.']
kobenhavn_h = [55.6683331, 12.5670127, 'Hovedbaneg%C3%A5rden%20st.']
vesterport = [55.6757871, 12.5709609, 'Vesterport%20st.']
norreport = [55.6810076, 12.5748877, 'N%C3%B8rreport%20st.']

# Defining the part of the C line I use on my way home from work
c_line = [skovlunde, herlev, husum, islev, jyllingevej, vanlose, flintholm, peter_bangs_vej, langgade, valby, enghave, dybbolsbro, kobenhavn_h, vesterport, norreport]

list_of_distances = []

# GPS coordinate pair math
def distance_from(my_coordinates, station):
distance = math.hypot(station[0]-my_coordinates[0], station[1]-my_coordinates[1])
return distance

# Generating a list of distances from which the shortest is found
for station in c_line:
list_of_distances.append(distance_from(me, station))

# Variables used in the url derived from list_of_distances
station = c_line[list_of_distances.index(min(list_of_distances))][2]
minutes = str(c_line.index(c_line[list_of_distances.index(min(list_of_distances))]) *2+10)

# Concatenating url elements and calling the url using Launch Center Pros url-scheme
sms_url = 'launch://messaging?to=%2B4529725044&amp;body=' + 'Er%20ved%20' + station +  '%20er%20hjemme%20om%20ca.%20' + minutes + '%20minutter...'
webbrowser.open(sms_url)</code></pre>


<p>I første omgang ville jeg egentligt have brugt et eller andet kort-api. Det havde nok været mere elegant. Men dels så gad jeg ikke rette til, hvis de laver noget om, dels vil det tage længere tid at slå op i et api end selv at beregne og dels er det her bare nemmere. :)</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Dog nok ikke der hvor man forestiller sig, for logikken var relativt nem. Det største problem opstod nemlig som en formateringsfejl på et '&amp;', da jeg kopierede koden fra min computer til min telefon. Men her var <a href="https://twitter.com/LaunchCenterPro">@launchcenterpro</a> hurtige med svar på twitter.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
    </div>
	<div class="navleft">
		<a rel="prev prefetch" href="/archive.html">&lsaquo;&nbsp; Til arkivet</a>
	</div>

        <div id="footer">
            <p>Kresten Jacobsen @ logiskhave</p><p>Udgivet under <a href="//static.logiskhave.dk/solipsistisk_licens.html">Solipsistisk Offentlig Licens</a></p>
        </div><!-- /footer -->
    </div><!-- /container -->
</body>
</html>